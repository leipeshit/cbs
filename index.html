
<!DOCTYPE html>
<html>
<head>
  <title>CSB data with d3.js</title>
  <link href="styles.css" media="all" rel="stylesheet" type="text/css" />
  <script src="colorbrewer.js" type="text/javascript"></script>
  <script src="topojson.js" type="text/javascript"></script>
  <script src="d3.js" type="text/javascript"></script>
  <script src="shizzle.js" type="text/javascript"></script>
  <script src="shizzle.utils.js" type="text/javascript"></script>
  <script src="shizzle.charts.donut.js" type="text/javascript"></script>
  <script src="shizzle.charts.map.js" type="text/javascript"></script>
  <script src="cbs_data.js" type="text/javascript"></script>
</head>
<body>

<header class='title'>
<hgroup>
<h1>
CBS data
</h1>
<h2>
with d3.js
</h2>
</hgroup>
<p>
<strong>Map and donuts can be clicked to filter the data</strong>
</p>
<p>
Using <a href="http://d3js.org/">d3.js</a> to display the CBS data <br/>found at <a href="http://www.nationaalgeoregister.nl/geonetwork/srv/search/?uuid=aeba6452-2025-444b-86aa-6ff4b23b3878">CBS Wijken en Buurten 2012 versie 1 WFS</a> specifically the <br/>gemeenten2012(municipalities) dataset in geojson format.
</p>
<p>
Tutorial will follow soon!
</p>
<p>
<a href="http://moop.me">Benjamin Udink ten Cate</a>, 2013
</p>
</header>
<div id='map'></div>
<div id='stats'>
<div class='donut' id='genders'></div>
<div class='donut' id='civil_registrations'></div>
<div class='donut' id='age'></div>
<div class='donut' id='households'></div>
<div class='donut' id='lineages'></div>
</div>
<a href="https://github.com/leipeshit/cbs"><img style="position: absolute; top: 0; left: 0; border: 0; z-index: 100;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"></a>
<script>
  window.onload=function(){
  
    //cbs_data.loadData
    //cbs_view.display()
  
    d3.json("gemeenten_topo.json", function(error, nl) {
      cbs_data.set_data(nl);
  
      var donuts = [
        shizzle.charts.donut()
          .title("Leeftijd")
          .data_keys(cbs_data.collections().ages)
          .color_range(colorbrewer.RdPu)
          .page_data(cbs_data.geometries()),
        shizzle.charts.donut()
          .title("Burgerlijke stand")
          .data_keys(cbs_data.collections().civil_registrations)
          .color_range(colorbrewer.Purples)
          .page_data(cbs_data.geometries()),
        shizzle.charts.donut()
          .title("Huishouden")
          .data_keys(cbs_data.collections().households)
          .color_range(colorbrewer.YlOrRd)
          .page_data(cbs_data.geometries()),
        shizzle.charts.donut()
          .title("Afkomst")
          .data_keys(cbs_data.collections().lineages)
          .color_range(colorbrewer.Oranges)
          .page_data(cbs_data.geometries()),
        shizzle.charts.donut()
          .title('Geslacht')
          .data_keys(cbs_data.collections().genders)
          .color_range(colorbrewer.Greens)
          .page_data(cbs_data.geometries()),
      ];
      var donut = d3.selectAll(".donut")
        .data(donuts);
  
      //var totaal_aantal_inwoners = d3.sum( cbs_data.geometries(), function(d) {return d.properties.aantal_inwoners});
      //color.domain(get_quantile_domain(cbs_data.geometries()));
      var map = shizzle.charts.map()
        .chart_data(topojson.feature(cbs_data.data(), cbs_data.data().objects.gemeenten))
        .color(d3.scale.threshold().range( colorbrewer.Blues[9]))
        .domain(shizzle.utils.quantiles(cbs_data.geometries(), 'percentage_aantal_inwoners'))
        .color_by(function(d){ return d.properties.percentage_aantal_inwoners });
  
  
      function renderAll() {
        donut.each(render);
        render(map);
      }
  
      function render(method) {
        d3.select(this).call(method);
      }
      window.set_dimension = function(title, legend, data_keys, color_domain){
        map.set_dimension(title, legend, data_keys, color_domain);
      };
      window.click = function(active) {
        donuts.forEach(function(donut, i) {
          donut.zoom_in(active);
        });
        map.zoom_in(active);
        d3.event.stopPropagation();
      };
  
      window.reset = function(i) {
        map.zoom_out();
        donuts.forEach(function(donut, i) {
          donut.zoom_out();
        });
      };
      d3.select(window).on("click", function() {
        map.zoom_out();
      });
  
      renderAll();
  
    });
  
  };
</script>


</body>
</html>
